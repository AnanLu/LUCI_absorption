

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Fitting Algorithm &mdash; LUCI v.0.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Welcome to LUCI’s documentation!" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> LUCI
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Fitting Algorithm</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#module-LuciFit">Fitting Functions</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">LUCI</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Fitting Algorithm</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/fits.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="fitting-algorithm">
<span id="fits"></span><h1>Fitting Algorithm<a class="headerlink" href="#fitting-algorithm" title="Permalink to this headline">¶</a></h1>
<p>This section contains the functions used to fit emission lines.</p>
<div class="toctree-wrapper compound">
</div>
<div class="section" id="module-LuciFit">
<span id="fitting-functions"></span><h2>Fitting Functions<a class="headerlink" href="#module-LuciFit" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="LuciFit.Fit">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">LuciFit.</span></span><span class="sig-name descname"><span class="pre">Fit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spectrum</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">axis</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wavenumbers_syn</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_type</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lines</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ML_model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Plot_bool</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#LuciFit.Fit" title="Permalink to this definition">¶</a></dt>
<dd><p>Class that defines the functions necessary for the modelling aspect. This includes
the gaussian fit functions, the prior definitions, the log likelihood, and the
definition of the posterior (log likelihood times prior).</p>
<dl class="py method">
<dt class="sig sig-object py" id="LuciFit.Fit.calculate_params">
<span class="sig-name descname"><span class="pre">calculate_params</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#LuciFit.Fit.calculate_params" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate the amplitude, position, and sigma of the line. These values are
calculated using the scipy.optimize.minimize function. This is called
on the log likelood previously described. The minimization algorithm uses
the SLSQP optimization implementation. We have applied standard bounds in order
to speed up the fitting. We also apply the fit on the normalized spectrum.
We then correct the flux by un-normalizing the spectrum.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="LuciFit.Fit.calculate_vel">
<span class="sig-name descname"><span class="pre">calculate_vel</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#LuciFit.Fit.calculate_vel" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate velocity given the fit of Halpha
TODO: Test</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>Velocity of the Halpha line in units of km/s</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="LuciFit.Fit.estimate_priors_ML">
<span class="sig-name descname"><span class="pre">estimate_priors_ML</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#LuciFit.Fit.estimate_priors_ML" title="Permalink to this definition">¶</a></dt>
<dd><p>TODO: Test
Apply machine learning algorithm on spectrum in order to estimate the velocity.
The spectrum fed into this method must be interpolated already onto the
reference spectrum axis AND normalized as described in Rhea et al. 2020a.
:param ml_dir: Relative path to the trained ML Predictor (e.g. R5000-PREDICITOR-I)</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>Updates self.vel_ml</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="LuciFit.Fit.fit">
<span class="sig-name descname"><span class="pre">fit</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#LuciFit.Fit.fit" title="Permalink to this definition">¶</a></dt>
<dd><p>Primary function call for a spectrum. This will estimate the velocity using
our machine learning algorithm described in Rhea et al. 2020a. Then we will
fit our lines using scipy.optimize.minimize.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="LuciFit.Fit.gaussian_model">
<span class="sig-name descname"><span class="pre">gaussian_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">channel</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">theta</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#LuciFit.Fit.gaussian_model" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to initiate the correct number of models to fit</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>channel</strong> – Wavelength Axis in cm-1</p></li>
<li><p><strong>theta</strong> – List of parameters for all the models in the following order
[amplitude, line location, sigma]</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Value of function given input parameters (theta)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="LuciFit.Fit.interpolate_spectrum">
<span class="sig-name descname"><span class="pre">interpolate_spectrum</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#LuciFit.Fit.interpolate_spectrum" title="Permalink to this definition">¶</a></dt>
<dd><p>Interpolate Spectrum given the wavelength axis of reference spectrum.
Then normalize the spectrum so that the max value equals 1</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>Populates self.spectrum_interpolated, self.spectrum_scale, and self.spectrum_interp_norm.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="LuciFit.Fit.line_vals_estimate">
<span class="sig-name descname"><span class="pre">line_vals_estimate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">line_name</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#LuciFit.Fit.line_vals_estimate" title="Permalink to this definition">¶</a></dt>
<dd><p>TODO: Test</p>
<p>Function to estimate the position and amplitude of a given line.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>spec</strong> – Spectrum flux values</p></li>
<li><p><strong>line_name</strong> – Name of model. Available options are ‘Halpha’, ‘NII6548’, ‘NII6543’, ‘SII6716’, ‘SII6731’</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Estimated line amplitude in units of cm-1 (line_amp_est) and estimate line position in units of cm-1 (line_pos_est)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="LuciFit.Fit.log_likelihood">
<span class="sig-name descname"><span class="pre">log_likelihood</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">theta</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">yerr</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#LuciFit.Fit.log_likelihood" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate log likelihood function evaluated given parameters on spectral axis</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>- List of parameters for all the models in the following order</strong> (<em>theta</em>) – [amplitude, line location, sigma]</p></li>
<li><p><strong>yerr</strong> – Error on Spectrum’s flux values (default 1e-2)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Value of log likelihood</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="LuciFit.Fit.plot">
<span class="sig-name descname"><span class="pre">plot</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#LuciFit.Fit.plot" title="Permalink to this definition">¶</a></dt>
<dd><p>Plot initial spectrum and fitted spectrum</p>
</dd></dl>

</dd></dl>

</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="index.html" class="btn btn-neutral float-left" title="Welcome to LUCI’s documentation!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Carter L. Rhea.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>